Apollo Cyber R\-T framework is built based on the concept of component. As a basic building block of Apollo Cyber R\-T framework, each component contains a specific algorithm module which process a set of data inputs and generate a set of outputs.

In order to successfully create and launch a new compoent, there are four essential steps that need to happen\-:


\begin{DoxyItemize}
\item Set up the component file structure
\item Implement the component class
\item Set up the configuration files
\item Launch the component
\end{DoxyItemize}

The example below demonstrates how to create a simple component, then build, run and watch the final output on screen. If you would like to explore more about Apollo Cyber R\-T, you can find a couple of examples showing how to use different functionalities of the framework under directory {\ttfamily /apollo/cyber/examples/}.

{\itshape Note\-: the example has to be run within apollo docker environment and it's compiled with Bazel.}

\subsection*{Set up the component file structure}

Please create the following files, assumed under the directory of {\ttfamily /apollo/cyber/examples/common\-\_\-component\-\_\-example/}\-:


\begin{DoxyItemize}
\item Header file\-: \hyperlink{common__component__example_8h}{common\-\_\-component\-\_\-example.\-h}
\item Source file\-: common\-\_\-component\-\_\-example.\-cc
\item Build file\-: B\-U\-I\-L\-D
\item D\-A\-G dependency file\-: common.\-dag
\item Launch file\-: common.\-launch
\end{DoxyItemize}

\subsection*{Implement the component class}

\subsubsection*{Implement component header file}

To implement {\ttfamily \hyperlink{common__component__example_8h}{common\-\_\-component\-\_\-example.\-h}}\-:


\begin{DoxyItemize}
\item Inherit the Component class
\item Define your own {\ttfamily Init} and {\ttfamily Proc} functions. Proc function needs to specify its input data types
\item Register your component classes to be global by using {\ttfamily C\-Y\-B\-E\-R\-\_\-\-R\-E\-G\-I\-S\-T\-E\-R\-\_\-\-C\-O\-M\-P\-O\-N\-E\-N\-T}
\end{DoxyItemize}

```cpp \#include $<$memory$>$ \#include \char`\"{}cyber/class\-\_\-loader/class\-\_\-loader.\-h\char`\"{} \#include \char`\"{}cyber/component/component.\-h\char`\"{} \#include \char`\"{}cyber/examples/proto/examples.\-pb.\-h\char`\"{}

using apollo\-::cyber\-::examples\-::proto\-::\-Driver; using \hyperlink{classapollo_1_1cyber_1_1Component}{apollo\-::cyber\-::\-Component}; using \hyperlink{classapollo_1_1cyber_1_1ComponentBase}{apollo\-::cyber\-::\-Component\-Base};

class \hyperlink{classCommonComponentSample}{Common\-Component\-Sample} \-: public \hyperlink{classapollo_1_1cyber_1_1Component}{Component$<$\-Driver, Driver$>$} \{ public\-: bool \hyperlink{namespaceapollo_1_1cyber_a2d055a81b338116634deaf8ac3367aca}{Init()} override; bool Proc(const std\-::shared\-\_\-ptr$<$\-Driver$>$\& msg0, const std\-::shared\-\_\-ptr$<$\-Driver$>$\& msg1) override; \};

\hyperlink{component_8h_a031103527dc7f59a627459d635de10f8}{C\-Y\-B\-E\-R\-\_\-\-R\-E\-G\-I\-S\-T\-E\-R\-\_\-\-C\-O\-M\-P\-O\-N\-E\-N\-T(\-Common\-Component\-Sample)} ```

\subsubsection*{Implement the source file for the example component}

For {\ttfamily common\-\_\-component\-\_\-example.\-cc}, both {\ttfamily Init} and {\ttfamily Proc} functions need to be implemented.

```cpp \#include \char`\"{}cyber/examples/common\-\_\-component\-\_\-example/common\-\_\-component\-\_\-example.\-h\char`\"{} \#include \char`\"{}cyber/class\-\_\-loader/class\-\_\-loader.\-h\char`\"{} \#include \char`\"{}cyber/component/component.\-h\char`\"{}

bool \hyperlink{classCommonComponentSample_ae2a3f8c8ce4b9cfd9c6b357628bc84ee}{Common\-Component\-Sample\-::\-Init()} \{ A\-I\-N\-F\-O $<$$<$ \char`\"{}\-Commontest component init\char`\"{}; return true; \}

bool \hyperlink{classCommonComponentSample_ab84ea2f74b8ab92a74733b392319ea5e}{Common\-Component\-Sample\-::\-Proc}(const std\-::shared\-\_\-ptr$<$\-Driver$>$\& msg0, const std\-::shared\-\_\-ptr$<$\-Driver$>$\& msg1) \{ A\-I\-N\-F\-O $<$$<$ \char`\"{}\-Start common component Proc \mbox{[}\char`\"{} $<$$<$ msg0-\/$>$msg\-\_\-id() $<$$<$ \char`\"{}\mbox{]} \mbox{[}\char`\"{} $<$$<$ msg1-\/$>$msg\-\_\-id() $<$$<$ \char`\"{}\mbox{]}\char`\"{}; return true; \} ```

\subsubsection*{Create the build file for the example component}

Create bazel B\-U\-I\-L\-D file.

```bash load(\char`\"{}//tools\-:cpplint.\-bzl\char`\"{}, \char`\"{}cpplint\char`\"{})

package(default\-\_\-visibility = \mbox{[}\char`\"{}//visibility\-:public\char`\"{}\mbox{]})

cc\-\_\-binary( name = \char`\"{}libcommon\-\_\-component\-\_\-example.\-so\char`\"{}, deps = \mbox{[}\char`\"{}\-:common\-\_\-component\-\_\-example\-\_\-lib\char`\"{}\mbox{]}, linkopts = \mbox{[}\char`\"{}-\/shared\char`\"{}\mbox{]}, linkstatic = False, )

cc\-\_\-library( name = \char`\"{}common\-\_\-component\-\_\-example\-\_\-lib\char`\"{}, srcs = \mbox{[} \char`\"{}common\-\_\-component\-\_\-example.\-cc\char`\"{}, \mbox{]}, hdrs = \mbox{[} \char`\"{}common\-\_\-component\-\_\-example.\-h\char`\"{}, \mbox{]}, deps = \mbox{[} \char`\"{}//cyber\char`\"{}, \char`\"{}//cyber/examples/proto\-:examples\-\_\-cc\-\_\-proto\char`\"{}, \mbox{]}, )

cpplint() ``` \subsection*{Set up the configuration files}

\subsubsection*{Configure the D\-A\-G dependency file}

To configure the D\-A\-G dependency file (common.\-dag), specify the following items as below\-:


\begin{DoxyItemize}
\item Channel names\-: for data input and output
\item Library path\-: library built from component class
\item Class name\-: the class name of the component
\end{DoxyItemize}

```bash \section*{Define all coms in D\-A\-G streaming.}

component\-\_\-config \{ component\-\_\-library \-: \char`\"{}/apollo/bazel-\/bin/cyber/examples/common\-\_\-component\-\_\-example/libcommon\-\_\-component\-\_\-example.\-so\char`\"{} components \{ class\-\_\-name \-: \char`\"{}\-Common\-Component\-Sample\char`\"{} config \{ name \-: \char`\"{}common\char`\"{} readers \{ channel\-: \char`\"{}/apollo/prediction\char`\"{} \} readers \{ channel\-: \char`\"{}/apollo/test\char`\"{} \} \} \} \} ```

\subsubsection*{Configure the launch file}

To configure the launch (common.\-launch) file, specify the following items\-:


\begin{DoxyItemize}
\item The name of the component
\item The dag file you just created in the previous step.
\item The name of the process which the component runs within
\end{DoxyItemize}

```bash $<$cyber$>$ $<$component$>$ $<$name$>$common$<$/name$>$ $<$dag\-\_\-conf$>$/apollo/cyber/examples/common\-\_\-component\-\_\-example/common.dag$<$/dag\-\_\-conf$>$ $<$process\-\_\-name$>$common$<$/process\-\_\-name$>$ $<$/component$>$ $<$/cyber$>$ ```

\subsection*{Launch the component}

Build the component by running the command below\-:

```bash bash /apollo/apollo.sh build ```

Note\-: make sure the example component builds fine

Then configure the environment\-:

```bash cd /apollo/cyber source setup.\-bash ```

There are two ways to launch the component\-:


\begin{DoxyItemize}
\item Launch with the launch file (recommended)
\end{DoxyItemize}

```bash cyber\-\_\-launch start /apollo/cyber/examples/common\-\_\-component\-\_\-example/common.launch ```


\begin{DoxyItemize}
\item Launch with the D\-A\-G file
\end{DoxyItemize}

```bash mainboard -\/d /apollo/cyber/examples/common\-\_\-component\-\_\-example/common.dag ``` 